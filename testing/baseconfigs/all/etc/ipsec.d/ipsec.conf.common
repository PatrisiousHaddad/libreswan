# common pieces for ipsec.conf. No host addresses.
#
# for conns
# left  = WEST
# right = EAST
#
# for OE stuff,
# right = my stuff
# left  = other stuff.
#

# food groups: clear, clear-or-private, private-or-clear, private, block
# Tempting to use "postcard" instead of "clear"
# these are for a subnet behind us.

# a different named conn, so we can have a different policy
conn private-or-clear-all
	also=private-or-clear

# these are for self
conn clear
	type=passthrough
	authby=never
	right=%defaultroute
	left=%group
	#auto=route

conn clear-or-private
	type=passthrough
	right=%defaultroute
	left=%opportunisticgroup
	# by using "add", we get passive.
	# but this does not actually implement "clear" :-(
	failureshunt=passthrough
	#auto=route

conn private-or-clear
	type=tunnel
	right=%defaultroute
	left=%opportunisticgroup
	failureshunt=passthrough
	#auto=route

conn private
	type=tunnel
	right=%defaultroute
	left=%opportunisticgroup
	# without failureshunt, renegotiation will be tried.
	failureshunt=drop
	#auto=route

conn block
	type=reject
	authby=never
	right=%defaultroute
	left=%group
	#auto=route

# VPN connection
conn west-east
	left=192.1.2.45
	right=192.1.2.23
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@west
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=west-leftrsasigkey
	also=east-rightrsasigkey
	#auto=start

# alias for the testcases
conn westnet-eastnet
	leftsubnet=192.0.1.0/24
	rightsubnet=192.0.2.0/24
	left=192.1.2.45
	leftnexthop=192.1.2.23
	right=192.1.2.23
	rightnexthop=192.1.2.45
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@west
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=west-leftrsasigkey
	also=east-rightrsasigkey

conn westnet-eastnet-ipv4
	leftsubnet=192.0.1.0/24
	rightsubnet=192.0.2.0/24
	left=192.1.2.45
	leftnexthop=192.1.2.23
	right=192.1.2.23
	rightnexthop=192.1.2.45
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@west
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=west-leftrsasigkey
	also=east-rightrsasigkey

conn northnet-eastnet
	leftsubnet=192.0.3.0/24
	rightsubnet=192.0.2.0/24
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@road
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=road-leftrsasigkey
	also=east-rightrsasigkey

conn road-east
	right=192.1.2.23
	#left not specified as test case picks "random" ip
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@road
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=road-leftrsasigkey
	also=east-rightrsasigkey

conn road-eastnet
	rightsubnet=192.0.2.0/24
	right=192.1.2.23
	#left not specified as test case picks "random" ip
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@road
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=road-leftrsasigkey
	also=east-rightrsasigkey

conn westnet-eastnet-x509
	leftsubnet=192.0.1.0/24
	leftsourceip=192.0.1.254
	rightsubnet=192.0.2.0/24
	rightsourceip=192.0.2.254
        # Left security gateway, subnet behind it, next hop toward right.
        left=192.1.2.45
        leftrsasigkey=%cert
        #leftcert=west
        leftnexthop=192.1.2.23
        leftid=%fromcert
        # Right security gateway, subnet behind it, next hop toward left.
        right=192.1.2.23
        rightid=%fromcert
        rightrsasigkey=%cert
        #rightcert=east
        rightnexthop=192.1.2.45

# aliases for old test cases - ideally testcases stop using these two names

conn west-east-base
	left=192.1.2.45
	leftnexthop=192.1.2.23
	right=192.1.2.23
	rightnexthop=192.1.2.45
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@west
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=west-leftrsasigkey
	also=east-rightrsasigkey

conn road-east-base
	right=192.1.2.23
	#left not specified as test case picks "random" ip
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@road
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=road-leftrsasigkey
	also=east-rightrsasigkey

conn road-east-base-id-nss
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@road
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
	also=road-leftrsasigkey
	also=east-rightrsasigkey

conn road-east-base-x509
        left=%defaultroute
        leftrsasigkey=%cert
        leftid=%fromcert
        leftcert=road
        # Right security gateway, subnet behind it,toward left.
        right=192.1.2.23
        rightid=%fromcert
        rightrsasigkey=%cert
        rightcert=east

conn rw-east-base-x509
        left=%any
        leftrsasigkey=%cert
        leftid=%fromcert
        # Right security gateway, subnet behind it,toward left.
        right=192.1.2.23
        rightid=%fromcert
        rightrsasigkey=%cert
        rightcert=east

conn west-east-x509
        # Left security gateway, subnet behind it, next hop toward right.
        left=192.1.2.45
        leftrsasigkey=%cert
        #leftcert=west
        leftnexthop=192.1.2.23
        leftid=%fromcert
        # Right security gateway, subnet behind it, next hop toward left.
        right=192.1.2.23
        rightid=%fromcert
        rightrsasigkey=%cert
        #rightcert=east
        rightnexthop=192.1.2.45

conn north-east
	# Left security gateway, subnet behind it, next hop toward right.
	#left=%defaultroute
	#left=%any
	#leftnexthop=192.2.3.254
	leftid=@north
	# Right security gateway, subnet behind it, next hop toward left.
	right=192.1.2.23
	rightid=@east
	rightnexthop=192.1.2.254
	also=north-leftrsasigkey
	also=east-rightrsasigkey

include /testing/baseconfigs/all/etc/ipsec.d/rsasigkey.conf
