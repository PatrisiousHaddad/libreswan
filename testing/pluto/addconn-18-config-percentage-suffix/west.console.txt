/testing/guestbin/swan-prep
west #
 ipsec start
Redirecting to: [initsystem]
west #
 ../../guestbin/wait-until-pluto-started
west #
 echo "initdone"
initdone
west #
 ipsec auto --add percentage-good
ipsec addconn: /etc/ipsec.conf:18: bad percentage multiplier "foo" on 10foo
"percentage-good": added IKEv2 connection
west #
 # rekey_margin: should be less than rekey interval
west #
 ipsec status | grep margin
"percentage-good":   ike_life: 28800s; ipsec_life: 28800s; ipsec_max_bytes: 2^63B; ipsec_max_packets: 2^63; replay_window: 128; rekey_margin: 540s; rekey_fuzz: 10%;
west #
 # output is unpredictable, include ephemeral values
west #
 ipsec addconn --verbose percentage-wip
opening file: /etc/ipsec.conf
| debugging mode enabled
ipsec addconn: /etc/ipsec.conf:18: bad percentage multiplier "foo" on 10foo
| EOF: stacktop->filename = /etc/ipsec.conf
| EOF: stacktop->filename = /etc/ipsec.conf
| EOF: no .fileglob
| end of file /etc/ipsec.conf
| loading conn percentage-good
| loading conn percentage-wip
| unbound context created - setting debug level to 5
| /etc/hosts lookups activated
| /etc/resolv.conf usage activated
| outgoing-port-avoid set 0-65535
| outgoing-port-permit set 32768-60999
| loading dnssec root key from:/var/lib/unbound/root.key
| no additional dnssec trust anchors defined via dnssec-trusted= option
loading named conns: percentage-wip
resolving family=IPv4 src=192.1.2.45 gateway=<not-set> peer 192.1.2.23
  seeking NOTHING
resolving family=IPv4 src=192.1.2.23 gateway=<not-set> peer 192.1.2.45
  seeking NOTHING
"percentage-wip": added IKEv2 connection
west #
 ipsec status | grep margin
"percentage-good":   ike_life: 28800s; ipsec_life: 28800s; ipsec_max_bytes: 2^63B; ipsec_max_packets: 2^63; replay_window: 128; rekey_margin: 540s; rekey_fuzz: 10%;
"percentage-wip":   ike_life: 28800s; ipsec_life: 28800s; ipsec_max_bytes: 2^63B; ipsec_max_packets: 2^63; replay_window: 128; rekey_margin: 540s; rekey_fuzz: 100%;
west #
 ipsec addconn --verbose percentage-wip
opening file: /etc/ipsec.conf
| debugging mode enabled
ipsec addconn: /etc/ipsec.conf:18: bad percentage multiplier "foo" on 10foo
| EOF: stacktop->filename = /etc/ipsec.conf
| EOF: stacktop->filename = /etc/ipsec.conf
| EOF: no .fileglob
| end of file /etc/ipsec.conf
| loading conn percentage-good
| loading conn percentage-wip
| unbound context created - setting debug level to 5
| /etc/hosts lookups activated
| /etc/resolv.conf usage activated
| outgoing-port-avoid set 0-65535
| outgoing-port-permit set 32768-60999
| loading dnssec root key from:/var/lib/unbound/root.key
| no additional dnssec trust anchors defined via dnssec-trusted= option
loading named conns: percentage-wip
resolving family=IPv4 src=192.1.2.45 gateway=<not-set> peer 192.1.2.23
  seeking NOTHING
resolving family=IPv4 src=192.1.2.23 gateway=<not-set> peer 192.1.2.45
  seeking NOTHING
"percentage-wip": added IKEv2 connection
west #
 ipsec status | grep margin
"percentage-good":   ike_life: 28800s; ipsec_life: 28800s; ipsec_max_bytes: 2^63B; ipsec_max_packets: 2^63; replay_window: 128; rekey_margin: 540s; rekey_fuzz: 10%;
"percentage-wip":   ike_life: 28800s; ipsec_life: 28800s; ipsec_max_bytes: 2^63B; ipsec_max_packets: 2^63; replay_window: 128; rekey_margin: 540s; rekey_fuzz: 100%;
west #
 
