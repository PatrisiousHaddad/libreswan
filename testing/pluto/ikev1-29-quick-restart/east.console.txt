/testing/guestbin/swan-prep
east #
 ipsec start
Redirecting to: [initsystem]
east #
 ../../guestbin/wait-until-pluto-started
east #
 ipsec add west-to-east
"west-to-east": added IKEv1 connection
east #
 echo "initdone"
initdone
east #
 >>>>>>>>>> post-mortem >>>>>>>>>>../../guestbin/post-mortem.sh
   PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND
:
: checking shutting down pluto
:
ipsec whack --shutdown
whack: is Pluto running?  connect() for "/run/pluto/pluto.ctl" failed (111 Connection refused)
FAIL: shutting down pluto
:
: checking core files
:
CORE FOUND: /tmp/core.east.pluto.638
Reading symbols from PATH/libexec/ipsec/pluto...
[New LWP 638]
[New LWP 640]
Missing separate debuginfo for /lib64/libpam.so.0.
The debuginfo package for this file is probably broken.
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
Core was generated by `PATH/libexec/ipsec/pluto --leak-detective --config /etc/ipsec.conf --nofo'.
Program terminated with signal SIGABRT, Aborted.
#0  __pthread_kill_implementation (threadid=<optimized out>, 
    signo=signo@entry=6, no_tid=no_tid@entry=0) at pthread_kill.c:44
44      return INTERNAL_SYSCALL_ERROR_P (ret) ? INTERNAL_SYSCALL_ERRNO (ret) : 0;
[Current thread is 1 (Thread 0x7fe59c88a980 (LWP 638))]
Missing separate debuginfos, use: dnf debuginfo-install krb5-libs-1.21.2-1.fc39.x86_64 libcap-2.48-7.fc39.x86_64 libeconf-0.5.2-1.fc39.x86_64 libnghttp2-1.55.1-2.fc39.x86_64 libstdc++-13.2.1-3.fc39.x86_64 libzstd-1.5.5-4.fc39.x86_64 protobuf-c-1.4.1-5.fc39.x86_64 python3-libs-3.12.0-1.fc39.x86_64 softhsm-2.6.1-5.fc39.7.x86_64
CRASHING THREAD:
#0  __pthread_kill_implementation (threadid=<optimized out>, signo=signo@entry=6, no_tid=no_tid@entry=0) at pthread_kill.c:44
#1  0x00007fe59d50d8a3 in __pthread_kill_internal (signo=6, threadid=<optimized out>) at pthread_kill.c:78
#2  0x00007fe59d4bb8ee in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26
#3  0x00007fe59d4a38ff in __GI_abort () at abort.c:79
#4  0x0000557c4e60091b in logjam_to_logger (logjam=logjam@entry=0x7fff2c869ab0) at /source/lib/libswan/logjam.c:51
#5  0x0000557c4e675031 in dispatch_1 (event=event@entry=CONNECTION_ESTABLISH_IKE_SA, c=0x7fe5989bda88, logger=logger@entry=0x7fe598874fc8, e=e@entry=0x7fff2c869fe0) at /source/programs/pluto/routing.c:2284
#6  0x0000557c4e6765a1 in dispatch (event=event@entry=CONNECTION_ESTABLISH_IKE_SA, c=<optimized out>, logger=0x7fe598874fc8, e=e@entry=0x7fff2c869fe0) at /source/programs/pluto/routing.c:2309
#7  0x0000557c4e677197 in connection_establish_ike (ike=<optimized out>, where=where@entry=0x557c4e7b86a0 <here>) at /source/programs/pluto/routing.c:1431
#8  0x0000557c4e692401 in ISAKMP_SA_established (ike=<optimized out>) at /source/programs/pluto/ikev1.c:3025
#9  0x0000557c4e6aaa26 in main_inI3_outR3 (st=<optimized out>, md=<optimized out>) at /source/programs/pluto/ikev1_main.c:1374
#10 0x0000557c4e69489e in process_packet_tail (md=md@entry=0x7fe59883a7a8) at /source/programs/pluto/ikev1.c:2322
#11 0x0000557c4e694cfd in process_v1_packet (md=md@entry=0x7fe59883a7a8) at /source/programs/pluto/ikev1.c:1783
#12 0x0000557c4e6bfb75 in process_md (md=0x7fe59883a7a8) at /source/programs/pluto/demux.c:171
#13 0x0000557c4e6bff0a in process_iface_packet (fd=<optimized out>, ifp_arg=0x0, logger=<optimized out>) at /source/programs/pluto/demux.c:294
#14 0x0000557c4e686a82 in fd_read_listener_event_handler (fd=<optimized out>, events=<optimized out>, arg=<optimized out>) at /source/programs/pluto/server.c:791
#15 0x00007fe59d687fec in event_persist_closure (ev=<optimized out>, base=<optimized out>) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1623
#16 event_process_active_single_queue (base=base@entry=0x7fe59935ad68, activeq=0x7fe599360fe8, max_to_process=max_to_process@entry=2147483647, endtime=endtime@entry=0x0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1682
#17 0x00007fe59d689ccf in event_process_active (base=0x7fe59935ad68) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1783
#18 event_base_loop (base=0x7fe59935ad68, flags=flags@entry=0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:2006
#19 0x0000557c4e68940e in run_server (conffile=0x7fe59bf6bfe8 "/etc/ipsec.conf", logger=0x7fff2c86b350) at /source/programs/pluto/server.c:1066
#20 0x0000557c4e602d82 in main (argc=<optimized out>, argv=<optimized out>) at /source/programs/pluto/plutomain.c:1838
INSTRUCTION:
=> 0x7fe59d50d834 <__pthread_kill_implementation+276>:mov    %eax,%ebx
SOURCE CODE:
39         delivery of all pending signals after unblocking in the code
40         below.  POSIX only guarantees delivery of a single signal,
41         which may not be the right one.)  */
42      pid_t tid = INTERNAL_SYSCALL_CALL (gettid);
43      int ret = INTERNAL_SYSCALL_CALL (tgkill, __getpid (), tid, signo);
44      return INTERNAL_SYSCALL_ERROR_P (ret) ? INTERNAL_SYSCALL_ERRNO (ret) : 0;
45    }
46
47  /* Block all signals, as required by pd->exit_lock.  */
48  internal_sigset_t old_mask;
LOCAL VARIABLES:
tid = <optimized out>
ret = 0
pd = <optimized out>
old_mask = {__val = {0}}
ret = <optimized out>
FUNCTION ARGUMENTS:
threadid = <optimized out>
signo = 6
no_tid = 0
LOCAL SCOPE:
requires an argument (function, line or *addr) to define a scope
FRAME:
Stack level 0, frame at 0x7fff2c869970:
 rip = 0x7fe59d50d834 in __pthread_kill_implementation (pthread_kill.c:44); saved rip = 0x7fe59d50d8a3
 called by frame at 0x7fff2c869970
 source language c.
 Arglist at 0x7fff2c869960, args: threadid=<optimized out>, signo=signo@entry=6, no_tid=no_tid@entry=0
 Locals at 0x7fff2c869960, Previous frame's sp is 0x7fff2c869968
 Saved registers:
  rbx at 0x7fff2c869938, rbp at 0x7fff2c869960, r12 at 0x7fff2c869940, r13 at 0x7fff2c869948, r14 at 0x7fff2c869950, r15 at 0x7fff2c869958
REGISTERS:
rax            0x0                 0
rbx            0x27e               638
rcx            0x7fe59d50d834      140624163559476
rdx            0x6                 6
rsi            0x27e               638
rdi            0x27e               638
rbp            0x7fff2c869960      0x7fff2c869960
rsp            0x7fff2c869920      0x7fff2c869920
r8             0x0                 0
r9             0x1                 1
r10            0x8                 8
r11            0x246               582
r12            0x7fe59c88a980      140624150440320
r13            0x7fff2c86a590      140733940409744
r14            0x6                 6
r15            0x7fe5989bda88      140624084589192
rip            0x7fe59d50d834      0x7fe59d50d834 <__pthread_kill_implementation+276>
eflags         0x246               [ PF ZF IF ]
cs             0x33                51
ss             0x2b                43
ds             0x0                 0
es             0x0                 0
fs             0x0                 0
gs             0x0                 0
fs_base        0x7fe59c88a980      140624150440320
gs_base        0x0                 0
ALL THREADS:
Thread 2 (Thread 0x7fe5991c46c0 (LWP 640)):
#0  0x00007fe59d508169 in __futex_abstimed_wait_common64 (private=0, cancel=true, abstime=0x0, op=393, expected=0, futex_word=0x557c4e80b668 <backlog_cond+40>) at futex-internal.c:57
#1  __futex_abstimed_wait_common (futex_word=futex_word@entry=0x557c4e80b668 <backlog_cond+40>, expected=expected@entry=0, clockid=clockid@entry=0, abstime=abstime@entry=0x0, private=private@entry=0, cancel=cancel@entry=true) at futex-internal.c:87
#2  0x00007fe59d5081ef in __GI___futex_abstimed_wait_cancelable64 (futex_word=futex_word@entry=0x557c4e80b668 <backlog_cond+40>, expected=expected@entry=0, clockid=clockid@entry=0, abstime=abstime@entry=0x0, private=private@entry=0) at futex-internal.c:139
#3  0x00007fe59d50ab09 in __pthread_cond_wait_common (abstime=0x0, clockid=0, mutex=0x557c4e80b640 <backlog_cond>, cond=0x557c4e80b640 <backlog_cond>) at pthread_cond_wait.c:503
#4  ___pthread_cond_wait (cond=cond@entry=0x557c4e80b640 <backlog_cond>, mutex=mutex@entry=0x557c4e80b680 <backlog_mutex>) at pthread_cond_wait.c:618
#5  0x0000557c4e68ae1b in helper_thread (arg=0x7fe5991cefe8) at /source/programs/pluto/server_pool.c:239
#6  0x00007fe59d50b897 in start_thread (arg=<optimized out>) at pthread_create.c:444
#7  0x00007fe59d5926fc in clone3 () at ../sysdeps/unix/sysv/linux/x86_64/clone3.S:78
Thread 1 (Thread 0x7fe59c88a980 (LWP 638)):
#0  __pthread_kill_implementation (threadid=<optimized out>, signo=signo@entry=6, no_tid=no_tid@entry=0) at pthread_kill.c:44
#1  0x00007fe59d50d8a3 in __pthread_kill_internal (signo=6, threadid=<optimized out>) at pthread_kill.c:78
#2  0x00007fe59d4bb8ee in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26
#3  0x00007fe59d4a38ff in __GI_abort () at abort.c:79
#4  0x0000557c4e60091b in logjam_to_logger (logjam=logjam@entry=0x7fff2c869ab0) at /source/lib/libswan/logjam.c:51
#5  0x0000557c4e675031 in dispatch_1 (event=event@entry=CONNECTION_ESTABLISH_IKE_SA, c=0x7fe5989bda88, logger=logger@entry=0x7fe598874fc8, e=e@entry=0x7fff2c869fe0) at /source/programs/pluto/routing.c:2284
#6  0x0000557c4e6765a1 in dispatch (event=event@entry=CONNECTION_ESTABLISH_IKE_SA, c=<optimized out>, logger=0x7fe598874fc8, e=e@entry=0x7fff2c869fe0) at /source/programs/pluto/routing.c:2309
#7  0x0000557c4e677197 in connection_establish_ike (ike=<optimized out>, where=where@entry=0x557c4e7b86a0 <here>) at /source/programs/pluto/routing.c:1431
#8  0x0000557c4e692401 in ISAKMP_SA_established (ike=<optimized out>) at /source/programs/pluto/ikev1.c:3025
#9  0x0000557c4e6aaa26 in main_inI3_outR3 (st=<optimized out>, md=<optimized out>) at /source/programs/pluto/ikev1_main.c:1374
#10 0x0000557c4e69489e in process_packet_tail (md=md@entry=0x7fe59883a7a8) at /source/programs/pluto/ikev1.c:2322
#11 0x0000557c4e694cfd in process_v1_packet (md=md@entry=0x7fe59883a7a8) at /source/programs/pluto/ikev1.c:1783
#12 0x0000557c4e6bfb75 in process_md (md=0x7fe59883a7a8) at /source/programs/pluto/demux.c:171
#13 0x0000557c4e6bff0a in process_iface_packet (fd=<optimized out>, ifp_arg=0x0, logger=<optimized out>) at /source/programs/pluto/demux.c:294
#14 0x0000557c4e686a82 in fd_read_listener_event_handler (fd=<optimized out>, events=<optimized out>, arg=<optimized out>) at /source/programs/pluto/server.c:791
#15 0x00007fe59d687fec in event_persist_closure (ev=<optimized out>, base=<optimized out>) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1623
#16 event_process_active_single_queue (base=base@entry=0x7fe59935ad68, activeq=0x7fe599360fe8, max_to_process=max_to_process@entry=2147483647, endtime=endtime@entry=0x0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1682
#17 0x00007fe59d689ccf in event_process_active (base=0x7fe59935ad68) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1783
#18 event_base_loop (base=0x7fe59935ad68, flags=flags@entry=0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:2006
#19 0x0000557c4e68940e in run_server (conffile=0x7fe59bf6bfe8 "/etc/ipsec.conf", logger=0x7fff2c86b350) at /source/programs/pluto/server.c:1066
#20 0x0000557c4e602d82 in main (argc=<optimized out>, argv=<optimized out>) at /source/programs/pluto/plutomain.c:1838
FAIL: core files
:
: checking memory leaks
:
SKIP: memory leaks as pluto was not running
:
: checking reference leaks
:
SKIP: reference leaks as pluto was not running
:
: checking xfrm errors
:
SKIP: xfrm errors as pluto was not running
:
: checking state/policy entries
:
SKIP: state/policy entries as pluto was not running
:
: checking selinux audit records
:
type=AVC msg=audit(1705109832.676:121): avc:  denied  { write } for  pid=666 comm="tee" name="/" dev="tmpfs" ino=1 scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=dir permissive=1
type=AVC msg=audit(1705109832.677:122): avc:  denied  { add_name } for  pid=666 comm="tee" name="core.east.pluto.638" scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=dir permissive=1
type=AVC msg=audit(1705109832.677:123): avc:  denied  { create } for  pid=666 comm="tee" name="core.east.pluto.638" scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=file permissive=1
type=AVC msg=audit(1705109832.678:124): avc:  denied  { write open } for  pid=666 comm="tee" path="/tmp/core.east.pluto.638" dev="tmpfs" ino=22 scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=file permissive=1
FAIL: selinux audit records
saving rules in OUTPUT/post-mortem.east.audit2allow.rules
require {
	type kernel_generic_helper_t;
}
#============= kernel_generic_helper_t ==============
files_manage_generic_tmp_files(kernel_generic_helper_t)
insights_client_filetrans_tmp(kernel_generic_helper_t)
:
: unload any selinux modules
:
east #
 
