/testing/guestbin/swan-prep
east #
 ipsec start
Redirecting to: [initsystem]
east #
 ../../guestbin/wait-until-pluto-started
east #
 ipsec add west-to-east
"west-to-east": added IKEv1 connection
east #
 echo "initdone"
initdone
east #
 # to be sure; initiator's already received it
east #
 ../../guestbin/wait-for.sh --match '#2: sent Quick' -- cat /tmp/pluto.log
"west-to-east" #2: sent Quick Mode reply, inbound IPsec SA installed, expecting confirmation transport mode {ESP=>0xf2b40fe7 <0x55afc30a xfrm=AES_CBC_128-HMAC_SHA1_96 DPD=passive}
east #
 ipsec unroute west-to-east
[ 00.00] show_signal_msg: 29 callbacks suppressed
[ 00.00] pluto[623]: segfault at 0 ip 0000555d5177d299 sp 00007ffe57aa6be0 error 4 in pluto[555d51707000+115000] likely on CPU 0 (core 0, socket 0)
[ 00.00] Code: 8b 18 f3 0f 7e 43 60 c7 46 78 03 00 00 00 66 0f 6c c0 0f 11 86 58 01 00 00 e9 df fd ff ff 49 8b 46 08 49 8b 6e 18 4d 8b 66 30 <48> 8b 38 48 89 ee e8 9c 06 01 00 48 89 e9 4c 89 e2 48 89 de 4c 89
east #
 >>>>>>>>>> post-mortem >>>>>>>>>>../../guestbin/post-mortem.sh
   PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND
:
: checking shutting down pluto
:
ipsec whack --shutdown
whack: is Pluto running?  connect() for "/run/pluto/pluto.ctl" failed (111 Connection refused)
FAIL: shutting down pluto
:
: checking core files
:
CORE FOUND: /tmp/core.east.pluto.623
Reading symbols from PATH/libexec/ipsec/pluto...
[New LWP 623]
[New LWP 625]
Missing separate debuginfo for /lib64/libpam.so.0.
The debuginfo package for this file is probably broken.
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
Core was generated by `PATH/libexec/ipsec/pluto --leak-detective --config /etc/ipsec.conf --nofo'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  teardown_unrouted_inbound (event=CONNECTION_UNROUTE, story=0x0, 
    where=0x555d518b5b50 <here>, logger=0x7fc047c03fc8, 
    child=<error reading variable: Cannot access memory at address 0x0>, 
    c=0x7fc047df8a88) at /source/programs/pluto/routing.c:1015
warning: Source file is more recent than executable.
1015if (scheduled_child_revival(child, story)) {
[Current thread is 1 (Thread 0x7fc04b56c980 (LWP 623))]
Missing separate debuginfos, use: dnf debuginfo-install krb5-libs-1.21.2-1.fc39.x86_64 libcap-2.48-7.fc39.x86_64 libeconf-0.5.2-1.fc39.x86_64 libnghttp2-1.55.1-2.fc39.x86_64 libstdc++-13.2.1-3.fc39.x86_64 libzstd-1.5.5-4.fc39.x86_64 protobuf-c-1.4.1-5.fc39.x86_64 python3-libs-3.12.0-1.fc39.x86_64 softhsm-2.6.1-5.fc39.7.x86_64
CRASHING THREAD:
#0  teardown_unrouted_inbound (event=CONNECTION_UNROUTE, story=0x0, where=0x555d518b5b50 <here>, logger=0x7fc047c03fc8, child=<error reading variable: Cannot access memory at address 0x0>, c=0x7fc047df8a88) at /source/programs/pluto/routing.c:1015
#1  dispatch_1 (event=event@entry=CONNECTION_UNROUTE, c=0x7fc047df8a88, logger=logger@entry=0x7fc047c03fc8, e=e@entry=0x7ffe57aa7130) at /source/programs/pluto/routing.c:2134
#2  0x0000555d5177e5a1 in dispatch (event=event@entry=CONNECTION_UNROUTE, c=<optimized out>, c@entry=0x7fc047df8a88, logger=0x7fc047c03fc8, e=e@entry=0x7ffe57aa7130) at /source/programs/pluto/routing.c:2309
#3  0x0000555d5177f3cf in connection_unroute (c=c@entry=0x7fc047df8a88, where=where@entry=0x555d518b5b50 <here>) at /source/programs/pluto/routing.c:1481
#4  0x0000555d5173aa49 in unroute_connection (s=0x7fc047ca5ba8, c=0x7fc047df8a88) at /source/programs/pluto/whack_unroute.c:30
#5  whack_unroute_connection (m=0x7ffe57aa7620, s=0x7fc047ca5ba8, c=0x7fc047df8a88) at /source/programs/pluto/whack_unroute.c:58
#6  0x0000555d51732fd9 in whack_connections_by_name (each=0x7ffe57aa72b8, visit_connection=0x555d5173a980 <whack_unroute_connection>, visit_connections=0x555d51732d50 <visit_connections_root>, s=0x7fc047ca5ba8, m=0x7ffe57aa7620) at /source/programs/pluto/whack_connection.c:82
#7  whack_connections (m=m@entry=0x7ffe57aa7620, s=s@entry=0x7fc047ca5ba8, visit_connections=visit_connections@entry=0x555d51732d50 <visit_connections_root>, visit_connection=visit_connection@entry=0x555d5173a980 <whack_unroute_connection>, each=each@entry=0x7ffe57aa72b8) at /source/programs/pluto/whack_connection.c:303
#8  0x0000555d517334ed in whack_connection (m=m@entry=0x7ffe57aa7620, s=s@entry=0x7fc047ca5ba8, visit_connection=visit_connection@entry=0x555d5173a980 <whack_unroute_connection>, each=...) at /source/programs/pluto/whack_connection.c:351
#9  0x0000555d5173ac0b in whack_unroute (m=m@entry=0x7ffe57aa7620, s=s@entry=0x7fc047ca5ba8) at /source/programs/pluto/whack_unroute.c:106
#10 0x0000555d51730eb3 in whack_process (s=0x7fc047ca5ba8, m=0x7ffe57aa7620) at /source/programs/pluto/rcv_whack.c:553
#11 whack_handle (whackfd=<optimized out>, whack_logger=whack_logger@entry=0x7ffe57aa8c90) at /source/programs/pluto/rcv_whack.c:848
#12 0x0000555d51732229 in whack_handle_cb (fd=4, arg=<optimized out>, global_logger=0x7ffe57aa8cf0) at /source/programs/pluto/rcv_whack.c:750
#13 0x0000555d5178ea82 in fd_read_listener_event_handler (fd=<optimized out>, events=<optimized out>, arg=<optimized out>) at /source/programs/pluto/server.c:791
#14 0x00007fc04cb65fec in event_persist_closure (ev=<optimized out>, base=<optimized out>) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1623
#15 event_process_active_single_queue (base=base@entry=0x7fc048795d68, activeq=0x7fc04879bfe8, max_to_process=max_to_process@entry=2147483647, endtime=endtime@entry=0x0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1682
#16 0x00007fc04cb67ccf in event_process_active (base=0x7fc048795d68) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1783
#17 event_base_loop (base=0x7fc048795d68, flags=flags@entry=0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:2006
#18 0x0000555d5179140e in run_server (conffile=0x7fc04b487fe8 "/etc/ipsec.conf", logger=0x7ffe57aa8f80) at /source/programs/pluto/server.c:1066
#19 0x0000555d5170ad82 in main (argc=<optimized out>, argv=<optimized out>) at /source/programs/pluto/plutomain.c:1838
INSTRUCTION:
=> 0x555d5177d299 <dispatch_1+1337>:mov    (%rax),%rdi
SOURCE CODE:
1010      struct child_sa *child,
1011      struct logger *logger,
1012      where_t where,
1013      const char *story)
1014{
1015if (scheduled_child_revival(child, story)) {
1016unrouted_inbound_to_unrouted(event, c, logger, where, story);
1017return;
1018}
1019
LOCAL VARIABLES:
No locals.
FUNCTION ARGUMENTS:
event = CONNECTION_UNROUTE
story = 0x0
where = 0x555d518b5b50 <here>
logger = 0x7fc047c03fc8
child = <error reading variable child (Cannot access memory at address 0x0)>
c = 0x7fc047df8a88
LOCAL SCOPE:
requires an argument (function, line or *addr) to define a scope
FRAME:
Stack level 0, frame at 0x7ffe57aa70a0:
 rip = 0x555d5177d299 in teardown_unrouted_inbound (/source/programs/pluto/routing.c:1015); saved rip = 0x555d5177e5a1
 inlined into frame 1
 source language c.
 Arglist at unknown address.
 Locals at unknown address, Previous frame's sp in rsp
REGISTERS:
rax            0x0                 0
rbx            0x7fc047c03fc8      140463814229960
rcx            0x555d51842020      93859287932960
rdx            0x3                 3
rsi            0x7fc047df8a88      140463816280712
rdi            0x1                 1
rbp            0x0                 0x0
rsp            0x7ffe57aa6be0      0x7ffe57aa6be0
r8             0x0                 0
r9             0x1                 1
r10            0x0                 0
r11            0x293               659
r12            0x555d518b5b50      93859288406864
r13            0x555d5182c41b      93859287843867
r14            0x7ffe57aa7130      140730369208624
r15            0x7fc047df8a88      140463816280712
rip            0x555d5177d299      0x555d5177d299 <dispatch_1+1337>
eflags         0x10207             [ CF PF IF RF ]
cs             0x33                51
ss             0x2b                43
ds             0x0                 0
es             0x0                 0
fs             0x0                 0
gs             0x0                 0
fs_base        0x7fc04b56c980      140463874427264
gs_base        0x0                 0
ALL THREADS:
Thread 2 (Thread 0x7fc0485ff6c0 (LWP 625)):
#0  0x00007fc04c9e6169 in __futex_abstimed_wait_common64 (private=0, cancel=true, abstime=0x0, op=393, expected=0, futex_word=0x555d51913668 <backlog_cond+40>) at futex-internal.c:57
#1  __futex_abstimed_wait_common (futex_word=futex_word@entry=0x555d51913668 <backlog_cond+40>, expected=expected@entry=0, clockid=clockid@entry=0, abstime=abstime@entry=0x0, private=private@entry=0, cancel=cancel@entry=true) at futex-internal.c:87
#2  0x00007fc04c9e61ef in __GI___futex_abstimed_wait_cancelable64 (futex_word=futex_word@entry=0x555d51913668 <backlog_cond+40>, expected=expected@entry=0, clockid=clockid@entry=0, abstime=abstime@entry=0x0, private=private@entry=0) at futex-internal.c:139
#3  0x00007fc04c9e8b09 in __pthread_cond_wait_common (abstime=0x0, clockid=0, mutex=0x555d51913640 <backlog_cond>, cond=0x555d51913640 <backlog_cond>) at pthread_cond_wait.c:503
#4  ___pthread_cond_wait (cond=cond@entry=0x555d51913640 <backlog_cond>, mutex=mutex@entry=0x555d51913680 <backlog_mutex>) at pthread_cond_wait.c:618
#5  0x0000555d51792e1b in helper_thread (arg=0x7fc048609fe8) at /source/programs/pluto/server_pool.c:239
#6  0x00007fc04c9e9897 in start_thread (arg=<optimized out>) at pthread_create.c:444
#7  0x00007fc04ca706fc in clone3 () at ../sysdeps/unix/sysv/linux/x86_64/clone3.S:78
Thread 1 (Thread 0x7fc04b56c980 (LWP 623)):
#0  teardown_unrouted_inbound (event=CONNECTION_UNROUTE, story=0x0, where=0x555d518b5b50 <here>, logger=0x7fc047c03fc8, child=<error reading variable: Cannot access memory at address 0x0>, c=0x7fc047df8a88) at /source/programs/pluto/routing.c:1015
#1  dispatch_1 (event=event@entry=CONNECTION_UNROUTE, c=0x7fc047df8a88, logger=logger@entry=0x7fc047c03fc8, e=e@entry=0x7ffe57aa7130) at /source/programs/pluto/routing.c:2134
#2  0x0000555d5177e5a1 in dispatch (event=event@entry=CONNECTION_UNROUTE, c=<optimized out>, c@entry=0x7fc047df8a88, logger=0x7fc047c03fc8, e=e@entry=0x7ffe57aa7130) at /source/programs/pluto/routing.c:2309
#3  0x0000555d5177f3cf in connection_unroute (c=c@entry=0x7fc047df8a88, where=where@entry=0x555d518b5b50 <here>) at /source/programs/pluto/routing.c:1481
#4  0x0000555d5173aa49 in unroute_connection (s=0x7fc047ca5ba8, c=0x7fc047df8a88) at /source/programs/pluto/whack_unroute.c:30
#5  whack_unroute_connection (m=0x7ffe57aa7620, s=0x7fc047ca5ba8, c=0x7fc047df8a88) at /source/programs/pluto/whack_unroute.c:58
#6  0x0000555d51732fd9 in whack_connections_by_name (each=0x7ffe57aa72b8, visit_connection=0x555d5173a980 <whack_unroute_connection>, visit_connections=0x555d51732d50 <visit_connections_root>, s=0x7fc047ca5ba8, m=0x7ffe57aa7620) at /source/programs/pluto/whack_connection.c:82
#7  whack_connections (m=m@entry=0x7ffe57aa7620, s=s@entry=0x7fc047ca5ba8, visit_connections=visit_connections@entry=0x555d51732d50 <visit_connections_root>, visit_connection=visit_connection@entry=0x555d5173a980 <whack_unroute_connection>, each=each@entry=0x7ffe57aa72b8) at /source/programs/pluto/whack_connection.c:303
#8  0x0000555d517334ed in whack_connection (m=m@entry=0x7ffe57aa7620, s=s@entry=0x7fc047ca5ba8, visit_connection=visit_connection@entry=0x555d5173a980 <whack_unroute_connection>, each=...) at /source/programs/pluto/whack_connection.c:351
#9  0x0000555d5173ac0b in whack_unroute (m=m@entry=0x7ffe57aa7620, s=s@entry=0x7fc047ca5ba8) at /source/programs/pluto/whack_unroute.c:106
#10 0x0000555d51730eb3 in whack_process (s=0x7fc047ca5ba8, m=0x7ffe57aa7620) at /source/programs/pluto/rcv_whack.c:553
#11 whack_handle (whackfd=<optimized out>, whack_logger=whack_logger@entry=0x7ffe57aa8c90) at /source/programs/pluto/rcv_whack.c:848
#12 0x0000555d51732229 in whack_handle_cb (fd=4, arg=<optimized out>, global_logger=0x7ffe57aa8cf0) at /source/programs/pluto/rcv_whack.c:750
#13 0x0000555d5178ea82 in fd_read_listener_event_handler (fd=<optimized out>, events=<optimized out>, arg=<optimized out>) at /source/programs/pluto/server.c:791
#14 0x00007fc04cb65fec in event_persist_closure (ev=<optimized out>, base=<optimized out>) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1623
#15 event_process_active_single_queue (base=base@entry=0x7fc048795d68, activeq=0x7fc04879bfe8, max_to_process=max_to_process@entry=2147483647, endtime=endtime@entry=0x0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1682
#16 0x00007fc04cb67ccf in event_process_active (base=0x7fc048795d68) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:1783
#17 event_base_loop (base=0x7fc048795d68, flags=flags@entry=0) at PATH/src/debug/libevent-2.1.12-9.fc39.x86_64/event.c:2006
#18 0x0000555d5179140e in run_server (conffile=0x7fc04b487fe8 "/etc/ipsec.conf", logger=0x7ffe57aa8f80) at /source/programs/pluto/server.c:1066
#19 0x0000555d5170ad82 in main (argc=<optimized out>, argv=<optimized out>) at /source/programs/pluto/plutomain.c:1838
FAIL: core files
:
: checking memory leaks
:
SKIP: memory leaks as pluto was not running
:
: checking reference leaks
:
SKIP: reference leaks as pluto was not running
:
: checking xfrm errors
:
SKIP: xfrm errors as pluto was not running
:
: checking state/policy entries
:
SKIP: state/policy entries as pluto was not running
:
: checking selinux audit records
:
type=AVC msg=audit(1705109831.812:121): avc:  denied  { write } for  pid=660 comm="tee" name="/" dev="tmpfs" ino=1 scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=dir permissive=1
type=AVC msg=audit(1705109831.812:122): avc:  denied  { add_name } for  pid=660 comm="tee" name="core.east.pluto.623" scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=dir permissive=1
type=AVC msg=audit(1705109831.812:123): avc:  denied  { create } for  pid=660 comm="tee" name="core.east.pluto.623" scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=file permissive=1
type=AVC msg=audit(1705109831.812:124): avc:  denied  { write open } for  pid=660 comm="tee" path="/tmp/core.east.pluto.623" dev="tmpfs" ino=22 scontext=system_u:system_r:kernel_generic_helper_t:s0 tcontext=system_u:object_r:tmp_t:s0 tclass=file permissive=1
FAIL: selinux audit records
saving rules in OUTPUT/post-mortem.east.audit2allow.rules
require {
	type kernel_generic_helper_t;
}
#============= kernel_generic_helper_t ==============
files_manage_generic_tmp_files(kernel_generic_helper_t)
insights_client_filetrans_tmp(kernel_generic_helper_t)
:
: unload any selinux modules
:
east #
 
